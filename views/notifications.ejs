<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>ì•Œë¦¼ í˜ì´ì§€</title>
  <!-- ê³µí†µ í—¤ë” CSS -->
  <link rel="stylesheet" href="/styles/header.css" />
  <!-- ë©”ì¸ í˜ì´ì§€ ì „ìš© CSS -->
  <link rel="stylesheet" href="/styles/notifications.css" />
  <!-- í—¤ë” js -->
  <script src="/layouts/header.js" defer></script>
</head>

<body>
  <h2>ğŸ“¢ ì•Œë¦¼</h2>
  <ul id="notificationList"></ul>

  <script>
    const studentId = localStorage.getItem("loggedInUser");

    fetch(`/api/notifications?studentId=${studentId}`)
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("notificationList");
        list.innerHTML = "";

        if (data.length === 0) {
          list.innerHTML = "<li>ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</li>";
          return;
        }

        data.forEach(noti => {
          const item = document.createElement("li");

          // ì•Œë¦¼ì´ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ ë§í¬ ì¶”ê°€
          const link = document.createElement("a");
          const postType = noti.postType || 'club'; // ê¸°ë³¸ê°’ ì„¤ì •
          link.href = `/content/${noti.postId}?type=${postType}`;
          link.innerText = noti.message;
          link.style.textDecoration = "none";
          link.style.color = "#333";

          item.appendChild(link);
          list.appendChild(item);
          link.addEventListener("click", (e) => {
            e.preventDefault();

            fetch("/api/notifications/markAsRead", {
              method: "PATCH",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                studentId: studentId,
                postId: noti.postId,
              }),
            }).then(() => {
              window.location.href = `/content/${noti.postId}?type=${noti.postType}`;
            });
          });
        });
      })
      .catch(err => {
        console.error("ì•Œë¦¼ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
        document.getElementById("notificationList").innerHTML = "<li>ì•Œë¦¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</li>";
      });


  </script>
</body>

</html>